<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>Administraci√≥n de Pagos (Test)</title>
<style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f7f8;padding:20px;}
    .box{max-width:550px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.08);}
    h2{text-align:center;color:#8B0000;margin-bottom:20px; border-bottom: 2px solid #8B0000; padding-bottom: 10px;}
    label{display:block;margin-top:12px;color:#333;font-weight:600}
    input{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
    button{margin-top:16px;width:100%;padding:12px;border-radius:6px;border:none;background:#8B0000;color:#fff;cursor:pointer;font-weight:bold;transition:background .3s}
    button:hover{background:#A52A2A}
    .warn{background:#fff3cd;color:#856404; margin-top: 15px; padding: 10px; border-radius: 6px; text-align: center;}
    .err{background:#f8d7da;color:#721c24; margin-top: 15px; padding: 10px; border-radius: 6px;}
    .info{background:#d1ecf1;color:#0c5460; margin-top: 15px; padding: 10px; border-radius: 6px;}
</style>
</head>
<body>
<div class="box">
    <h2>üõ†Ô∏è Herramienta de Correcci√≥n de Pagos (Admin)</h2>
    <p class="warn">
        Advertencia: Esta herramienta es solo para modificar registros de pago (fecha/monto) para fines de prueba. 
        Modificar un pago *no* recalcula autom√°ticamente el saldo del pr√©stamo asociado.
    </p>

    <label for="idPagoAdmin">ID del Pago a Corregir</label>
    <input id="idPagoAdmin" placeholder="Ej: 1G2h3Jk4L5mN" />
    
    <label for="montoAdmin">Nuevo Monto Pagado</label>
    <input id="montoAdmin" type="number" step="0.01" />

    <label for="fechaAdmin">Nueva Fecha de Pago</label>
    <input id="fechaAdmin" type="date" />

    <button id="btnCorregirPago" onclick="corregirPago()">Corregir Pago Seleccionado</button>
    <div id="resultadoAdmin" class="resultado"></div>
</div>

<!-- Firebase v8 CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
/* ============ CONFIGURA AQU√ç ============ */
const firebaseConfig = {
    // Reemplaza con tus datos de configuraci√≥n reales
    apiKey: "AIzaSyCuGggEvH6leC6-tWBpN-5BXC37U-NsFqU",
    authDomain: "finanzas-excel30.firebaseapp.com",
    projectId: "finanzas-excel30",
    storageBucket: "finanzas-excel30.firebasestorage.app",
    messagingSenderId: "508931220293",
    appId: "1:508931220293:web:d64cf5125c37d5bae3142c",
    measurementId: "G-2YZ3YREX0P"
};
/* ======================================== */

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const pagosRef = db.collection('pagos');

const resultadoAdminDiv = document.getElementById('resultadoAdmin');

// Funciones de utilidad para el panel de administraci√≥n
function mostrarAdminInfo(text){resultadoAdminDiv.textContent=text;resultadoAdminDiv.className='info';}
function mostrarAdminError(text){resultadoAdminDiv.textContent=text;resultadoAdminDiv.className='err';}


// === L√ìGICA DE ADMINISTRACI√ìN PARA CORREGIR PAGOS ===
async function corregirPago() {
    const idPago = (document.getElementById('idPagoAdmin').value || '').trim();
    const nuevoMonto = parseFloat(document.getElementById('montoAdmin').value);
    const nuevaFecha = document.getElementById('fechaAdmin').value;

    if (!idPago) {
        mostrarAdminError('Debe ingresar el ID del Pago a corregir.');
        return;
    }

    const updates = {};
    let mensaje = `Pago ${idPago} corregido: `;

    if (!isNaN(nuevoMonto) && nuevoMonto > 0) {
        updates.monto = parseFloat(nuevoMonto.toFixed(2));
        mensaje += `Monto a $${updates.monto.toFixed(2)}. `;
    }

    if (nuevaFecha) {
        try {
            const date = new Date(nuevaFecha);
            if (isNaN(date)) throw new Error('Fecha inv√°lida');
            // Convertir la fecha HTML (YYYY-MM-DD) a Firestore Timestamp
            updates.fecha = firebase.firestore.Timestamp.fromDate(date);
            mensaje += `Fecha a ${nuevaFecha}.`;
        } catch (e) {
            mostrarAdminError('La fecha ingresada no es v√°lida.');
            return;
        }
    }
    
    if (Object.keys(updates).length === 0) {
        mostrarAdminError('No se ingresaron nuevos valores para monto o fecha.');
        return;
    }

    mostrarAdminInfo('Corrigiendo pago...');

    try {
        const pagoDocRef = pagosRef.doc(idPago);
        await pagoDocRef.update(updates);
        
        mostrarAdminInfo(`‚úÖ ${mensaje}`);
        
        // Limpiar formulario y advertir
        document.getElementById('idPagoAdmin').value = '';
        document.getElementById('montoAdmin').value = '';
        document.getElementById('fechaAdmin').value = '';
        
        // Mensaje de advertencia final
        setTimeout(() => {
            mostrarAdminInfo('¬°√âxito! Recuerde que este cambio *no* actualiz√≥ el saldo del Pr√©stamo.');
        }, 3000);

    } catch (error) {
        console.error("Error al corregir el pago:", error);
        mostrarAdminError(`Error al corregir el pago: ${error.message}. Aseg√∫rese de que el ID del pago sea correcto.`);
    }
}
</script>
</body>
</html>

